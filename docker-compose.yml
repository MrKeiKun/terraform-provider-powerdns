services:
  pdns-auth:
    image: powerdns/pdns-auth-50
    user: root
    ports:
      - "8081:8081"
    volumes:
      - lmdb_test_data:/data
      - ./test/pdns.conf:/etc/powerdns/pdns.conf
      - ./test/init-pdns-auth.sh:/usr/local/bin/init-pdns-auth.sh
    entrypoint: /usr/local/bin/init-pdns-auth.sh
    restart: unless-stopped

  pdns-rec:
    image: powerdns/pdns-recursor-53
    command:
      - "--webserver=yes"
      - "--webserver-address=0.0.0.0"
      - "--webserver-port=8082"
      - "--webserver-allow-from=0.0.0.0/0"
      - "--api-key=secret"
      - "--api-config-dir=/etc/powerdns/recursor"
      - "--loglevel=6"
      - "--disable-syslog=yes"
    ports:
      - "8082:8082"
    volumes:
      - ./test/recursor-config:/etc/powerdns/recursor
    restart: unless-stopped

volumes:
  lmdb_test_data:
